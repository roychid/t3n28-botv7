<!DOCTYPE html>
<html>
<head>
  <title>t3n28-bot </title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: Arial; background:#0a0a0a; color:#fff; padding:20px; }
    .container { max-width:1200px; margin:0 auto; }
    header { text-align:center; margin-bottom:30px; padding-bottom:20px; border-bottom:2px solid #00ff00; }
    h1 { font-size:28px; color:#00ff00; margin-bottom:5px; }
    .subtitle { color:#888; font-size:14px; }
    .controls { background:#1a1a1a; padding:20px; border-radius:8px; margin-bottom:30px; border:1px solid #333; }
    .control-row { display:flex; gap:10px; flex-wrap:wrap; }
    input, select { padding:10px; background:#0a0a0a; border:1px solid #00ff00; color:#fff; border-radius:4px; font-size:14px; }
    input:focus, select:focus { outline:none; border-color:#00ff00; box-shadow:0 0 5px rgba(0,255,0,0.3); }
    button { padding:10px 20px; background:#00ff00; color:#000; border:none; border-radius:4px; font-weight:bold; cursor:pointer; font-size:14px; }
    button:hover { background:#00cc00; }
    button:active { background:#009900; }
    .btn-secondary { background:#333; color:#00ff00; border:1px solid #00ff00; }
    .btn-secondary:hover { background:#444; }
    .games-list { display:grid; gap:20px; }
    .game-card { background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:20px; }
    .game-header { display:flex; justify-content:space-between; margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #333; }
    .league { color:#00ff00; font-size:12px; font-weight:bold; }
    .time { color:#888; font-size:12px; }
    .teams { display:grid; grid-template-columns:1fr auto 1fr; gap:20px; margin-bottom:20px; align-items:center; }
    .team { text-align:center; }
    .team-name { font-size:18px; font-weight:bold; margin-bottom:10px; }
    .form { display:flex; gap:5px; justify-content:center; }
    .form-box { width:22px; height:22px; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:bold; border-radius:3px; }
    .W { background:#00ff00; color:#000; }
    .D { background:#666; color:#fff; }
    .L { background:#ff0000; color:#fff; }
    .vs { font-size:18px; color:#666; font-weight:bold; }
    .stats { display:grid; grid-template-columns:repeat(auto-fit, minmax(150px,1fr)); gap:15px; margin-bottom:20px; }
    .stat { background:#0a0a0a; padding:12px; border-radius:4px; border:1px solid #333; }
    .stat-label { font-size:11px; color:#888; margin-bottom:5px; text-transform:uppercase; }
    .stat-value { display:flex; justify-content:space-between; font-size:16px; font-weight:bold; }
    .stat-home { color:#00ff00; }
    .stat-away { color:#fff; }
    .advice { background:#0a0a0a; padding:15px; border-radius:4px; border-left:3px solid #00ff00; }
    .advice-title { color:#00ff00; font-size:14px; font-weight:bold; margin-bottom:10px; }
    .advice-text { color:#ccc; font-size:13px; line-height:1.6; margin-bottom:10px; }
    .recommendation { display:inline-block; background:#00ff00; color:#000; padding:8px 15px; border-radius:4px; font-weight:bold; font-size:13px; margin-right:10px; }
    .confidence { color:#888; font-size:12px; }
    .loading, .no-games { text-align:center; padding:40px; color:#888; }
    .no-games { background:#1a1a1a; border-radius:8px; border:1px solid #333; }
    
    /* New styles for upgraded version */
    .loading { text-align: center; padding: 60px 20px; color: #00ff00; font-size: 16px; }
    .loading:after { content: ''; display: inline-block; width: 20px; height: 20px; border: 2px solid #00ff00; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; margin-left: 10px; vertical-align: middle; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .probability-bar { display: flex; height: 6px; background: #333; border-radius: 3px; margin: 10px 0; overflow: hidden; }
    .probability-home { background: #00ff00; }
    .probability-draw { background: #666; }
    .probability-away { background: #fff; }
    .insight-badge { display: inline-block; background: rgba(0, 255, 0, 0.1); color: #00ff00; padding: 3px 8px; border-radius: 10px; font-size: 10px; margin: 2px; }
    .h2h-badge { display: inline-block; background: rgba(255, 255, 255, 0.1); color: #ccc; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-right: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚öΩ SOCCER BETTING ANALYSIS - EUROPE ONLY</h1>
      <p class="subtitle">AI-Powered Predictions with Real Historical Data (European Leagues)</p>
    </header>

    <div class="controls">
      <div class="control-row">
        <input type="date" id="dateInput" />
        <select id="leagueSelect">
          <option value="">All European Leagues</option>
          <option value="39">England: Premier League</option>
          <option value="140">Spain: La Liga</option>
          <option value="78">Germany: Bundesliga</option>
          <option value="135">Italy: Serie A</option>
          <option value="61">France: Ligue 1</option>
          <option value="94">Portugal: Primeira Liga</option>
          <option value="88">Netherlands: Eredivisie</option>
          <option value="144">Belgium: Jupiler Pro League</option>
          <option value="203">Turkey: S√ºper Lig</option>
          <option value="218">Austria: Bundesliga</option>
          <option value="119">Scotland: Premiership</option>
          <option value="253">Switzerland: Super League</option>
          <option value="106">Greece: Super League</option>
          <option value="283">Denmark: Superliga</option>
          <option value="268">Russia: Premier League</option>
          <option value="271">Ukraine: Premier League</option>
          <option value="299">Poland: Ekstraklasa</option>
          <option value="197">Czech Republic: First League</option>
          <option value="2">UEFA: Champions League</option>
          <option value="3">UEFA: Europa League</option>
          <option value="848">UEFA: Europa Conference League</option>
        </select>
        <button onclick="loadTodaysGames()">LOAD GAMES</button>
        <button onclick="refreshData()" class="btn-secondary">üîÑ Refresh</button>
      </div>
      <div style="margin-top: 10px; font-size: 12px; color: #666;">
        Showing predictions for European leagues only ‚Ä¢ Based on last 10 matches & H2H history
      </div>
    </div>

    <div id="output">
      <div class="loading">Loading European fixtures...</div>
    </div>
    
    <footer style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #333; color: #666; font-size: 12px;">
      <p>‚ö†Ô∏è For entertainment purposes only. Always gamble responsibly.</p>
      <p>Data provided by API-Sports ‚Ä¢ European leagues analysis updated every 5 minutes</p>
    </footer>
  </div>

  <script>
    // European league IDs (API-Football IDs)
    const EUROPEAN_LEAGUES = [
      39,    // England: Premier League
      140,   // Spain: La Liga
      78,    // Germany: Bundesliga
      135,   // Italy: Serie A
      61,    // France: Ligue 1
      94,    // Portugal: Primeira Liga
      88,    // Netherlands: Eredivisie
      144,   // Belgium: Jupiler Pro League
      203,   // Turkey: S√ºper Lig
      218,   // Austria: Bundesliga
      119,   // Scotland: Premiership
      253,   // Switzerland: Super League
      106,   // Greece: Super League
      283,   // Denmark: Superliga
      268,   // Russia: Premier League
      271,   // Ukraine: Premier League
      299,   // Poland: Ekstraklasa
      197,   // Czech Republic: First League
      2,     // UEFA Champions League
      3,     // UEFA Europa League
      848    // UEFA Europa Conference League
    ];
    
    document.getElementById('dateInput').valueAsDate = new Date();
    
    // Format time from ISO string
    function formatTime(dateString) {
      if (!dateString) return "TBD";
      const date = new Date(dateString);
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    // Format league name
    function formatLeagueName(league) {
      if (!league) return "Unknown League";
      return `${league.country || ''} ${league.name}`.trim();
    }
    
    // Generate insights based on stats
    function generateInsights(stats, isHome) {
      const insights = [];
      
      if (!stats) return insights;
      
      if (parseFloat(stats.goalsScored) > 1.8) {
        insights.push(isHome ? "Home: High scoring" : "Away: High scoring");
      }
      if (parseFloat(stats.goalsConceded) < 1.0) {
        insights.push(isHome ? "Home: Solid defense" : "Away: Solid defense");
      }
      if (stats.winRate > 60) {
        insights.push(isHome ? "Home: Excellent form" : "Away: Excellent form");
      }
      if (stats.cleanSheets > 50) {
        insights.push(isHome ? "Home: Frequent clean sheets" : "Away: Frequent clean sheets");
      }
      if (stats.bttsRate > 70) {
        insights.push(isHome ? "Home: BTTS often" : "Away: BTTS often");
      }
      
      return insights;
    }
    
    // Get form class for styling
    function getFormClass(result) {
      if (result === 'W') return 'W';
      if (result === 'D') return 'D';
      if (result === 'L') return 'L';
      return '';
    }
    
    // Get confidence color
    function getConfidenceColor(confidence) {
      if (confidence >= 70) return '#00ff00';
      if (confidence >= 50) return '#ffaa00';
      return '#ff4444';
    }
    
    // Get H2H summary
    function getH2HSummary(h2hMatches, homeId) {
      if (!h2hMatches || h2hMatches.length === 0) return null;
      
      let homeWins = 0, awayWins = 0, draws = 0;
      
      h2hMatches.forEach(match => {
        if (match.goals.home > match.goals.away) {
          homeWins++;
        } else if (match.goals.away > match.goals.home) {
          awayWins++;
        } else {
          draws++;
        }
      });
      
      return { homeWins, awayWins, draws, total: h2hMatches.length };
    }
    
    // Check if league is European
    function isEuropeanLeague(leagueId) {
      return EUROPEAN_LEAGUES.includes(leagueId);
    }
    
    // Main function to load games
    async function loadTodaysGames() {
      const output = document.getElementById('output');
      output.innerHTML = '<div class="loading">üîÑ Loading European fixtures with real-time analysis...</div>';
      
      const selectedLeague = document.getElementById('leagueSelect').value;
      const date = document.getElementById('dateInput').value;
      
      try {
        const params = new URLSearchParams({ date });
        if (selectedLeague) {
          params.append('league', selectedLeague);
        } else {
          // If "All European Leagues" is selected, fetch each league individually
          // or use a server-side endpoint that handles multiple leagues
          params.append('leagues', EUROPEAN_LEAGUES.join(','));
        }
        
        // Note: You'll need to update your API endpoint to handle multiple leagues
        const res = await fetch(`/api/fixtures?${params}`);
        
        if (!res.ok) {
          throw new Error(`API returned ${res.status}`);
        }
        
        const data = await res.json();
        
        // Filter to only include European leagues (server-side should handle this, but double-check)
        let fixtures = data.fixtures || [];
        
        if (!selectedLeague) {
          // Client-side filtering as backup
          fixtures = fixtures.filter(fixture => 
            isEuropeanLeague(fixture.league.id)
          );
        }
        
        if (fixtures.length === 0) {
          output.innerHTML = `
            <div class="no-games">
              <h3>No European Fixtures Found</h3>
              <p>No European matches scheduled for ${date}${selectedLeague ? ' in selected league' : ''}.</p>
              <p>Try a different date or select another European league.</p>
            </div>
          `;
          return;
        }
        
        let html = `<div class="games-list">`;
        
        fixtures.forEach(game => {
          const analysis = game.analysis || { 
            recommendation: "NO DATA", 
            confidence: 0, 
            advice: "Analysis unavailable",
            probabilities: { home: 33, draw: 33, away: 33 }
          };
          
          const homeStats = game.stats?.home || { 
            goalsScored: "0.0", 
            goalsConceded: "0.0", 
            winRate: 0, 
            cleanSheets: 0,
            bttsRate: 0
          };
          
          const awayStats = game.stats?.away || { 
            goalsScored: "0.0", 
            goalsConceded: "0.0", 
            winRate: 0,
            cleanSheets: 0,
            bttsRate: 0
          };
          
          const homeForm = game.form?.home || ['-', '-', '-', '-', '-'];
          const awayForm = game.form?.away || ['-', '-', '-', '-', '-'];
          
          const homeInsights = generateInsights(homeStats, true);
          const awayInsights = generateInsights(awayStats, false);
          
          const h2hSummary = getH2HSummary(game.h2h, game.teams.home.id);
          
          const confidenceColor = getConfidenceColor(analysis.confidence);
          
          // Probability bars
          const probHome = analysis.probabilities?.home || 33;
          const probDraw = analysis.probabilities?.draw || 33;
          const probAway = analysis.probabilities?.away || 33;
          
          // Add European flag/indicator
          const europeanFlag = "üá™üá∫";
          
          html += `
            <div class="game-card">
              <div class="game-header">
                <div class="league">
                  ${europeanFlag} ${game.league.country ? `${game.league.country}: ` : ''}${game.league.name}
                  ${game.league.logo ? `<img src="${game.league.logo}" style="height: 16px; vertical-align: middle; margin-left: 5px;">` : ''}
                </div>
                <div class="time">${formatTime(game.fixture.date)}</div>
              </div>
              
              <div class="teams">
                <div class="team">
                  <div class="team-name">${game.teams.home.name}</div>
                  <div class="form">
                    ${homeForm.map(result => `
                      <span class="form-box ${getFormClass(result)}">
                        ${result}
                      </span>
                    `).join('')}
                  </div>
                  ${homeInsights.length > 0 ? `
                    <div style="margin-top: 8px;">
                      ${homeInsights.map(insight => `
                        <span class="insight-badge">${insight}</span>
                      `).join('')}
                    </div>
                  ` : ''}
                </div>
                
                <div class="vs">VS</div>
                
                <div class="team">
                  <div class="team-name">${game.teams.away.name}</div>
                  <div class="form">
                    ${awayForm.map(result => `
                      <span class="form-box ${getFormClass(result)}">
                        ${result}
                      </span>
                    `).join('')}
                  </div>
                  ${awayInsights.length > 0 ? `
                    <div style="margin-top: 8px;">
                      ${awayInsights.map(insight => `
                        <span class="insight-badge">${insight}</span>
                      `).join('')}
                    </div>
                  ` : ''}
                </div>
              </div>
              
              ${h2hSummary ? `
                <div style="background: #111; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 12px;">
                  <div style="color: #888; margin-bottom: 5px;">HEAD-TO-HEAD (Last ${h2hSummary.total} matches):</div>
                  <div style="display: flex; justify-content: space-around;">
                    <span style="color: #00ff00;">${game.teams.home.name}: ${h2hSummary.homeWins}W</span>
                    <span style="color: #666;">Draws: ${h2hSummary.draws}</span>
                    <span style="color: #fff;">${game.teams.away.name}: ${h2hSummary.awayWins}W</span>
                  </div>
                </div>
              ` : ''}
              
              <div class="stats">
                <div class="stat">
                  <div class="stat-label">Goals Scored/Game</div>
                  <div class="stat-value">
                    <span class="stat-home">${homeStats.goalsScored}</span>
                    <span class="stat-away">${awayStats.goalsScored}</span>
                  </div>
                </div>
                <div class="stat">
                  <div class="stat-label">Goals Conceded/Game</div>
                  <div class="stat-value">
                    <span class="stat-home">${homeStats.goalsConceded}</span>
                    <span class="stat-away">${awayStats.goalsConceded}</span>
                  </div>
                </div>
                <div class="stat">
                  <div class="stat-label">Win Rate (Last 10)</div>
                  <div class="stat-value">
                    <span class="stat-home">${homeStats.winRate}%</span>
                    <span class="stat-away">${awayStats.winRate}%</span>
                  </div>
                </div>
                ${homeStats.cleanSheets !== undefined ? `
                  <div class="stat">
                    <div class="stat-label">Clean Sheet Rate</div>
                    <div class="stat-value">
                      <span class="stat-home">${homeStats.cleanSheets}%</span>
                      <span class="stat-away">${awayStats.cleanSheets || 0}%</span>
                    </div>
                  </div>
                ` : ''}
              </div>
              
              <div class="advice">
                <div class="advice-title">üìä AI PREDICTION ANALYSIS</div>
                <div class="advice-text">${analysis.advice || "No analysis available"}</div>
                
                <div class="probability-bar">
                  <div class="probability-home" style="width: ${probHome}%"></div>
                  <div class="probability-draw" style="width: ${probDraw}%"></div>
                  <div class="probability-away" style="width: ${probAway}%"></div>
                </div>
                
                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 10px;">
                  <span style="color: #00ff00;">Home: ${probHome}%</span>
                  <span style="color: #666;">Draw: ${probDraw}%</span>
                  <span style="color: #fff;">Away: ${probAway}%</span>
                </div>
                
                <div style="display: flex; align-items: center; margin-top: 15px;">
                  <span class="recommendation">${analysis.recommendation}</span>
                  <span class="confidence" style="color: ${confidenceColor}">
                    Confidence: ${analysis.confidence}%
                  </span>
                </div>
                
                ${game.h2h && game.h2h.length > 0 ? `
                  <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #333;">
                    <div style="font-size: 11px; color: #888; margin-bottom: 5px;">LAST MEETING:</div>
                    <div style="font-size: 12px; color: #ccc;">
                      ${game.h2h[0].teams.home.name} ${game.h2h[0].goals.home}-${game.h2h[0].goals.away} ${game.h2h[0].teams.away.name}
                      <span style="color: #666; font-size: 11px; margin-left: 10px;">
                        ${new Date(game.h2h[0].fixture.date).toLocaleDateString()}
                      </span>
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        });
        
        html += `</div>`;
        output.innerHTML = html;
        
        // Add data freshness indicator
        const freshness = document.createElement('div');
        freshness.style.cssText = 'text-align: center; margin-top: 20px; color: #666; font-size: 12px; padding: 10px; background: #111; border-radius: 4px;';
        freshness.innerHTML = `üìä Data updated: ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} ‚Ä¢ ${fixtures.length} European matches analyzed`;
        output.appendChild(freshness);
        
      } catch (err) {
        console.error('Error loading games:', err);
        output.innerHTML = `
          <div class="no-games">
            <h3>‚ö†Ô∏è Connection Error</h3>
            <p>Failed to fetch data from API. Possible issues:</p>
            <ul style="text-align: left; margin: 15px auto; max-width: 400px; color: #888; font-size: 12px;">
              <li>API service may be temporarily unavailable</li>
              <li>Daily API limit may be reached</li>
              <li>Check your internet connection</li>
            </ul>
            <button onclick="loadTodaysGames()" style="margin-top: 15px; padding: 10px 25px; font-size: 14px;">
              üîÑ Retry Connection
            </button>
            <div style="margin-top: 20px; font-size: 11px; color: #666;">
              Error details: ${err.message}
            </div>
          </div>
        `;
      }
    }
    
    // Refresh data function
    function refreshData() {
      loadTodaysGames();
    }
    
    // Load today's games on page load
    window.onload = loadTodaysGames;
    
    // Auto-refresh every 5 minutes (optional)
    setInterval(() => {
      const now = new Date();
      if (now.getSeconds() === 0) { // Check every minute
        console.log('Auto-refresh check...');
      }
    }, 60000);
  </script>
</body>
</html>
